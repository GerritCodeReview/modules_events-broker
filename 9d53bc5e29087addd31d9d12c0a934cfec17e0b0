{
  "comments": [
    {
      "unresolved": false,
      "key": {
        "uuid": "8540aa47_b0132e01",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 6
      },
      "lineNbr": 0,
      "author": {
        "id": 1083454
      },
      "writtenOn": "2023-11-08T10:11:40Z",
      "side": 1,
      "message": "That\u0027s a step in the right direction but my understating from the kick-off call was that we want to move BrokerApiWrapper[1] from multi-site to events-broker. This will allow us to have a unified way of logging across all plugins and implementations\n\n https://gerrit.googlesource.com/plugins/multi-site/+/refs/heads/master/src/main/java/com/googlesource/gerrit/plugins/multisite/broker/BrokerApiWrapper.java",
      "revId": "9d53bc5e29087addd31d9d12c0a934cfec17e0b0",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "3e8bac02_59c3b431",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 6
      },
      "lineNbr": 0,
      "author": {
        "id": 1157810
      },
      "writtenOn": "2023-11-08T13:00:15Z",
      "side": 1,
      "message": "The `BrokerApiWrapper` has nothing to do with _stream_ events, which the issue is about. AFAIU only the publishing of stream events was moved to the events-broker, so publishing of index changes, cache evictions etc is still done in multi-site through the `BrokerApiWrapper`. The existing implementation allows a unified way of logging across all plugins and implementations when it comes to _publishing of stream events_.",
      "parentUuid": "8540aa47_b0132e01",
      "revId": "9d53bc5e29087addd31d9d12c0a934cfec17e0b0",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "97715f61_46b0649b",
        "filename": "src/main/java/com/gerritforge/gerrit/eventbroker/BrokerApiModule.java",
        "patchSetId": 6
      },
      "lineNbr": 49,
      "author": {
        "id": 1010134
      },
      "writtenOn": "2023-11-08T12:04:41Z",
      "side": 1,
      "message": "Do we expect any other implementations of `MessageLogger`?\n\nIf not, then I\u0027d argue that we don\u0027t need that interface at all. We can go with a concrete implementation. Additionally, binding this way prevents from replacing implementation in the runtime, which makes even less sense of having a split into the interface and implementation.",
      "revId": "9d53bc5e29087addd31d9d12c0a934cfec17e0b0",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "6e43319e_b42c89f5",
        "filename": "src/main/java/com/gerritforge/gerrit/eventbroker/BrokerApiModule.java",
        "patchSetId": 6
      },
      "lineNbr": 49,
      "author": {
        "id": 1157810
      },
      "writtenOn": "2023-11-08T13:00:15Z",
      "side": 1,
      "message": "I don\u0027t disagree, however I used what was already there in multi-site. I will let other people comment on why it was done like this and if your suggestion makes sense (to me it does, but i am lacking context).",
      "parentUuid": "97715f61_46b0649b",
      "revId": "9d53bc5e29087addd31d9d12c0a934cfec17e0b0",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "27c54530_08c8ec24",
        "filename": "src/main/java/com/gerritforge/gerrit/eventbroker/publisher/StreamEventPublisher.java",
        "patchSetId": 6
      },
      "lineNbr": 84,
      "author": {
        "id": 1010134
      },
      "writtenOn": "2023-11-08T12:04:41Z",
      "side": 1,
      "message": "Is there any reason why we log a message after it is sent?\n\nI\u0027d expect it to be logged before it is propagated, to have a trace in the log file when propagation fails. This is also a good practice to log an event before it is processed.",
      "revId": "9d53bc5e29087addd31d9d12c0a934cfec17e0b0",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "80e77fd9_e2998efc",
        "filename": "src/main/java/com/gerritforge/gerrit/eventbroker/publisher/StreamEventPublisher.java",
        "patchSetId": 6
      },
      "lineNbr": 84,
      "author": {
        "id": 1157810
      },
      "writtenOn": "2023-11-08T13:00:15Z",
      "side": 1,
      "message": "Actually, I dont agree here. To me it makes sense to log a message _after_ it is published to confirm the fact, otherwise the log is simply confusing: if the publishing fails, the log still suggests we published the message. Keep in mind that failures are logged in the error_log file.",
      "parentUuid": "27c54530_08c8ec24",
      "revId": "9d53bc5e29087addd31d9d12c0a934cfec17e0b0",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "a4cae886_4a5a1ac0",
        "filename": "src/test/java/com/gerritforge/gerrit/eventbroker/StreamEventPublisherTest.java",
        "patchSetId": 6
      },
      "lineNbr": 154,
      "author": {
        "id": 1010134
      },
      "writtenOn": "2023-11-08T12:04:41Z",
      "side": 1,
      "message": "should we also have a test to ensure that the event is logged when propagation fails?",
      "revId": "9d53bc5e29087addd31d9d12c0a934cfec17e0b0",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "2800b5d7_a5ab89a5",
        "filename": "src/test/java/com/gerritforge/gerrit/eventbroker/StreamEventPublisherTest.java",
        "patchSetId": 6
      },
      "lineNbr": 154,
      "author": {
        "id": 1157810
      },
      "writtenOn": "2023-11-08T13:00:15Z",
      "side": 1,
      "message": "See my comment above, errors are logged in the error_log file AFAIU.",
      "parentUuid": "a4cae886_4a5a1ac0",
      "revId": "9d53bc5e29087addd31d9d12c0a934cfec17e0b0",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    }
  ]
}